<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Banker Dashboard - Monopoly Money</title>
  
  <!-- Google Material Symbols -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #F5F5F5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .banker-container {
      background: white;
      border-radius: 32px;
      padding: 30px;
      max-width: 440px;
      width: 100%;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .logo-icon {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    .logo-icon .material-symbols-rounded {
      font-size: 32px;
      color: white;
      font-variation-settings: 'FILL' 1, 'wght' 400;
    }

    .reset-icon {
      width: 48px;
      height: 48px;
      background: white;
      border: 2px solid #E5E7EB;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .reset-icon:hover {
      border-color: #6366F1;
      background: #F5F7FF;
    }

    .reset-icon .material-symbols-rounded {
      font-size: 24px;
      color: #1F2937;
      font-variation-settings: 'FILL' 0, 'wght' 400;
    }

    .banker-info {
      margin-bottom: 30px;
    }

    .greeting {
      font-size: 24px;
      font-weight: 600;
      color: #1F2937;
      margin-bottom: 8px;
    }

    .room-id {
      font-size: 16px;
      color: #9CA3AF;
    }

    .players-section {
      margin-bottom: 30px;
    }

    .player-card {
      background: linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%);
      border: 2px solid #C7D2FE;
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 16px;
    }

    .player-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .player-name {
      font-size: 16px;
      font-weight: 600;
      color: #1F2937;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #10B981;
    }

    .status-indicator.offline {
      background: #EF4444;
    }

    .status-text {
      font-size: 12px;
      color: #6B7280;
    }

    .player-balance {
      font-size: 48px;
      font-weight: 700;
      color: #6366F1;
      line-height: 1;
      margin-bottom: 16px;
    }

    .player-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .btn-pay-player {
      padding: 14px;
      background: #6366F1;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-pay-player:hover {
      background: #5558E3;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.3);
    }

    .btn-collect {
      padding: 14px;
      background: #10B981;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-collect:hover {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.3);
    }

    .btn-leave {
      width: 100%;
      padding: 18px;
      background: #EF4444;
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-leave:hover {
      background: #DC2626;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
    }

    button:active {
      transform: translateY(0) !important;
    }

    .waiting-message {
      text-align: center;
      color: #9CA3AF;
      font-size: 14px;
      padding: 20px;
      background: #F9FAFB;
      border-radius: 12px;
      margin-bottom: 16px;
    }

    /* Amount Modal */
    .amount-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .amount-modal.active {
      display: flex;
    }

    .amount-content {
      background: white;
      border-radius: 24px;
      padding: 30px;
      max-width: 360px;
      width: 90%;
    }

    .modal-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .modal-back {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-back .material-symbols-rounded {
      font-size: 24px;
      color: #1F2937;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: #1F2937;
      margin-bottom: 8px;
    }

    .modal-subtitle {
      font-size: 14px;
      color: #9CA3AF;
    }

    .amount-display {
      width: 100%;
      padding: 24px;
      background: #D1FAE5;
      border: 2px solid #6EE7B7;
      border-radius: 12px;
      font-size: 40px;
      font-weight: 700;
      color: #10B981;
      text-align: center;
      margin-bottom: 20px;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .amount-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .amount-btn {
      padding: 20px;
      background: #000;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .amount-btn:hover {
      background: #1F2937;
      transform: scale(1.05);
    }

    .amount-btn:active {
      transform: scale(0.98);
    }

    .amount-btn.wide {
      grid-column: span 3;
    }

    .btn-send {
      width: 100%;
      padding: 18px;
      background: #10B981;
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-send:hover {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    }

    /* Notification Toast */
    .notification-toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #1F2937;
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      z-index: 9999;
      display: none;
      animation: slideDown 0.3s ease;
    }

    .notification-toast.show {
      display: block;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }
  </style>
</head>
<body>
  <!-- Notification Toast -->
  <div class="notification-toast" id="notificationToast"></div>

  <div class="banker-container">
    <div class="header">
      <div class="logo-icon">
        <span class="material-symbols-rounded">account_balance</span>
      </div>
      <div class="reset-icon" id="resetBtn" title="Reset Balances">
        <span class="material-symbols-rounded">refresh</span>
      </div>
    </div>

    <div class="banker-info">
      <div class="greeting">ðŸ‘‹ Hello Banker!</div>
      <div class="room-id">Room ID #<span id="roomIdDisplay">000000</span></div>
    </div>

    <div class="players-section" id="playersSection">
      <!-- Player cards will be inserted here -->
    </div>

    <button class="btn-leave" id="leaveRoom">Leave Room</button>
  </div>

  <!-- Amount Modal -->
  <div class="amount-modal" id="amountModal">
    <div class="amount-content">
      <button class="modal-back" id="modalBack">
        <span class="material-symbols-rounded">arrow_back</span>
      </button>
      
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Enter Amount to Send to Player</div>
        <div class="modal-subtitle" id="modalSubtitle">(Name1)</div>
      </div>
      
      <div class="amount-display" id="amountDisplay">2,000</div>
      
      <div class="amount-grid">
        <button class="amount-btn" data-amount="1">1</button>
        <button class="amount-btn" data-amount="5">5</button>
        <button class="amount-btn" data-amount="10">10</button>
        <button class="amount-btn" data-amount="20">20</button>
        <button class="amount-btn" data-amount="50">50</button>
        <button class="amount-btn" data-amount="100">100</button>
        <button class="amount-btn wide" data-amount="500">500</button>
      </div>
      
      <button class="btn-send" id="sendBtn">Send</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDrPA---Ak_l9jqwHouWiC2byZH6EdR9Ts",
  authDomain: "monopolymoneyapp.firebaseapp.com",
  databaseURL: "https://monopolymoneyapp-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "monopolymoneyapp",
  storageBucket: "monopolymoneyapp.firebasestorage.app",
  messagingSenderId: "734008146391",
  appId: "1:734008146391:web:8ebbf21a9c324b25587392",
  measurementId: "G-3377SYGJYX"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    console.log("âœ… Firebase initialized!");
  </script>
  
  <script>
    const roomId = localStorage.getItem('roomId');
    const bankerName = localStorage.getItem('bankerName');

    if (!roomId || !bankerName) {
      window.location.href = 'room.html';
    }

    document.getElementById('roomIdDisplay').textContent = roomId;

    let displayAmount = 0;
    let currentPlayer = null;
    let currentAction = null;

    function showNotification(message) {
      const toast = document.getElementById('notificationToast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function updateModalDisplay() {
      document.getElementById('amountDisplay').textContent = formatNumber(displayAmount);
    }

    // Listen to room changes
    database.ref('rooms/' + roomId).on('value', snapshot => {
      const room = snapshot.val();
      if (!room) {
        alert('Room no longer exists!');
        localStorage.clear();
        window.location.href = 'room.html';
        return;
      }

      const playersSection = document.getElementById('playersSection');
      playersSection.innerHTML = '';

      // Check for player1
      if (room.player1) {
        playersSection.innerHTML += createPlayerCard('player1', room.player1);
      } else {
        playersSection.innerHTML += '<div class="waiting-message">Waiting for Player 1 to join...</div>';
      }

      // Check for player2
      if (room.player2) {
        playersSection.innerHTML += createPlayerCard('player2', room.player2);
      } else {
        playersSection.innerHTML += '<div class="waiting-message">Waiting for Player 2 to join...</div>';
      }

      // Reattach event listeners
      attachPlayerActionListeners();
    });

    function createPlayerCard(playerRole, playerData) {
      const isOnline = playerData.active || false;
      const statusClass = isOnline ? '' : 'offline';
      const statusText = isOnline ? 'Online' : 'Offline';

      return `
        <div class="player-card">
          <div class="player-header">
            <div class="player-name">
              ${playerData.name}
              <span class="status-indicator ${statusClass}"></span>
            </div>
            <div class="status-text">${statusText}</div>
          </div>
          <div class="player-balance">â‚¹${formatNumber(playerData.balance)}</div>
          <div class="player-actions">
            <button class="btn-pay-player" data-player="${playerRole}" data-name="${playerData.name}">Pay Player</button>
            <button class="btn-collect" data-player="${playerRole}" data-name="${playerData.name}">Collect</button>
          </div>
        </div>
      `;
    }

    function attachPlayerActionListeners() {
      document.querySelectorAll('.btn-pay-player').forEach(btn => {
        btn.addEventListener('click', () => {
          currentPlayer = btn.dataset.player;
          currentAction = 'pay';
          displayAmount = 0;
          updateModalDisplay();
          document.getElementById('modalTitle').textContent = 'Enter Amount to Send to Player';
          document.getElementById('modalSubtitle').textContent = `(${btn.dataset.name})`;
          document.getElementById('amountModal').classList.add('active');
        });
      });

      document.querySelectorAll('.btn-collect').forEach(btn => {
        btn.addEventListener('click', () => {
          currentPlayer = btn.dataset.player;
          currentAction = 'collect';
          displayAmount = 0;
          updateModalDisplay();
          document.getElementById('modalTitle').textContent = 'Enter Amount to Collect from Player';
          document.getElementById('modalSubtitle').textContent = `(${btn.dataset.name})`;
          document.getElementById('amountModal').classList.add('active');
        });
      });
    }

    // Amount modal logic
    document.getElementById('modalBack').addEventListener('click', () => {
      document.getElementById('amountModal').classList.remove('active');
      displayAmount = 0;
    });

    document.querySelectorAll('.amount-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const amount = parseInt(btn.dataset.amount);
        displayAmount += amount;
        updateModalDisplay();
      });
    });

    document.getElementById('sendBtn').addEventListener('click', () => {
      if (displayAmount === 0) {
        alert('Please enter an amount!');
        return;
      }

      if (!currentPlayer) {
        alert('No player selected!');
        return;
      }

      database.ref('rooms/' + roomId + '/' + currentPlayer + '/balance').once('value')
        .then(snap => {
          const currentBalance = snap.val() || 3000;
          let newBalance;

          if (currentAction === 'pay') {
            newBalance = currentBalance + displayAmount;
            showNotification(`Paid â‚¹${formatNumber(displayAmount)} to player`);
          } else {
            newBalance = currentBalance - displayAmount;
            if (newBalance < 0) {
              alert('Player has insufficient balance!');
              return;
            }
            showNotification(`Collected â‚¹${formatNumber(displayAmount)} from player`);
          }

          database.ref('rooms/' + roomId + '/' + currentPlayer + '/balance').set(newBalance);
          document.getElementById('amountModal').classList.remove('active');
          displayAmount = 0;
        });
    });

    // Reset balances
    document.getElementById('resetBtn').addEventListener('click', () => {
      if (confirm('Reset all player balances to â‚¹3,000?')) {
        database.ref('rooms/' + roomId + '/player1/balance').set(3000);
        database.ref('rooms/' + roomId + '/player2/balance').set(3000);
        showNotification('All balances reset to â‚¹3,000');
      }
    });

    // Leave room
    document.getElementById('leaveRoom').addEventListener('click', () => {
      if (confirm('Leave this room? The room will be closed for all players.')) {
        database.ref('rooms/' + roomId).remove()
          .then(() => {
            localStorage.clear();
            window.location.href = 'room.html';
          });
      }
    });
  </script>
</body>
</html>