<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monopoly Money - Room</title>
  
  <!-- Google Material Symbols -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .card {
      background: white;
      border-radius: 24px;
      padding: 40px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .title {
      font-size: 28px;
      font-weight: 700;
      color: #1F2937;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 16px;
      color: #6B7280;
      margin-bottom: 32px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input {
      width: 100%;
      padding: 16px;
      border: 2px solid #E5E7EB;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .input:focus {
      outline: none;
      border-color: #8B5CF6;
    }

    .input::placeholder {
      color: #9CA3AF;
    }

    .btn {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 12px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .btn-primary {
      background: linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%);
      color: white;
    }

    .btn-banker {
      background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-secondary {
      background: #1F2937;
      color: white;
    }

    .divider {
      text-align: center;
      margin: 24px 0;
      color: #9CA3AF;
      font-size: 14px;
      position: relative;
    }

    .divider::before,
    .divider::after {
      content: '';
      position: absolute;
      top: 50%;
      width: 40%;
      height: 1px;
      background: #E5E7EB;
    }

    .divider::before {
      left: 0;
    }

    .divider::after {
      right: 0;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #1F2937;
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      z-index: 2000;
      display: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .toast.show {
      display: block;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1 class="title">Enter your name and Create or Join Room</h1>
    <p class="subtitle">Start playing Monopoly Money</p>

    <div class="input-group">
      <input type="text" class="input" id="playerName" placeholder="Name" maxlength="20">
    </div>

    <button class="btn btn-primary" onclick="createRoom()">Create Room</button>
    
    <button class="btn btn-banker" onclick="createBankerRoom()">
      <span class="material-symbols-rounded">account_balance</span>
      Create Room as Banker
    </button>

    <div class="divider">OR</div>

    <div class="input-group">
      <input type="text" class="input" id="roomIdInput" placeholder="Enter Room ID" maxlength="6">
    </div>

    <button class="btn btn-secondary" onclick="joinRoom()">Join Room</button>
  </div>

  <div class="toast" id="toast"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  
  <script>
    const firebaseConfig = {
     apiKey: "AIzaSyDrPA---Ak_l9jqwHouWiC2byZH6EdR9Ts",
  authDomain: "monopolymoneyapp.firebaseapp.com",
  databaseURL: "https://monopolymoneyapp-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "monopolymoneyapp",
  storageBucket: "monopolymoneyapp.firebasestorage.app",
  messagingSenderId: "734008146391",
  appId: "1:734008146391:web:8ebbf21a9c324b25587392",
  measurementId: "G-3377SYGJYX"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
  </script>
  
  <script>
    function generateRoomId() {
      return Math.floor(100000 + Math.random() * 900000).toString();
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    async function createRoom() {
      const playerName = document.getElementById('playerName').value.trim();
      
      if (!playerName) {
        showToast('Please enter your name');
        return;
      }

      const roomId = generateRoomId();
      
      try {
        // Create room with player1
        await database.ref(`rooms/${roomId}`).set({
          isBanker: false,
          createdAt: Date.now(),
          player1: {
            name: playerName,
            balance: 3000,
            online: true,
            properties: {}
          }
        });

        // Set up auto-cleanup after 24 hours
        setTimeout(() => {
          database.ref(`rooms/${roomId}`).remove();
        }, 24 * 60 * 60 * 1000);

        // Redirect to game page
        window.location.href = `game.html?room=${roomId}&player=player1`;
      } catch (error) {
        console.error('Error creating room:', error);
        showToast('Failed to create room. Please try again.');
      }
    }

    async function createBankerRoom() {
      const bankerName = document.getElementById('playerName').value.trim();
      
      if (!bankerName) {
        showToast('Please enter your name');
        return;
      }

      const roomId = generateRoomId();
      
      try {
        // Create banker room
        await database.ref(`rooms/${roomId}`).set({
          isBanker: true,
          createdAt: Date.now(),
          banker: {
            name: bankerName,
            online: true
          },
          player1: {
            name: '',
            balance: 3000,
            online: false,
            properties: {}
          },
          player2: {
            name: '',
            balance: 3000,
            online: false,
            properties: {}
          }
        });

        // Set up auto-cleanup after 24 hours
        setTimeout(() => {
          database.ref(`rooms/${roomId}`).remove();
        }, 24 * 60 * 60 * 1000);

        // Redirect to banker page
        window.location.href = `banker.html?room=${roomId}`;
      } catch (error) {
        console.error('Error creating banker room:', error);
        showToast('Failed to create banker room. Please try again.');
      }
    }

    async function joinRoom() {
      const playerName = document.getElementById('playerName').value.trim();
      const roomId = document.getElementById('roomIdInput').value.trim();
      
      if (!playerName) {
        showToast('Please enter your name');
        return;
      }

      if (!roomId || roomId.length !== 6) {
        showToast('Please enter a valid 6-digit Room ID');
        return;
      }

      try {
        const roomSnapshot = await database.ref(`rooms/${roomId}`).once('value');
        const roomData = roomSnapshot.val();

        if (!roomData) {
          showToast('Room not found. Please check the Room ID.');
          return;
        }

        // Check if it's a banker room
        if (roomData.isBanker) {
          // Join as player in banker room
          if (!roomData.player1 || !roomData.player1.name) {
            // Join as player1
            await database.ref(`rooms/${roomId}/player1`).update({
              name: playerName,
              balance: 3000,
              online: true,
              properties: {}
            });
            window.location.href = `game.html?room=${roomId}&player=player1`;
          } else if (!roomData.player2 || !roomData.player2.name) {
            // Join as player2
            await database.ref(`rooms/${roomId}/player2`).update({
              name: playerName,
              balance: 3000,
              online: true,
              properties: {}
            });
            window.location.href = `game.html?room=${roomId}&player=player2`;
          } else {
            showToast('Room is full (2 players maximum)');
          }
        } else {
          // Regular room (non-banker)
          if (roomData.player1 && !roomData.player2) {
            // Join as player2
            await database.ref(`rooms/${roomId}/player2`).set({
              name: playerName,
              balance: 3000,
              online: true,
              properties: {}
            });
            window.location.href = `game.html?room=${roomId}&player=player2`;
          } else if (roomData.player2 && !roomData.player1) {
            // Join as player1 (edge case)
            await database.ref(`rooms/${roomId}/player1`).set({
              name: playerName,
              balance: 3000,
              online: true,
              properties: {}
            });
            window.location.href = `game.html?room=${roomId}&player=player1`;
          } else if (roomData.player1 && roomData.player2) {
            showToast('Room is full (2 players maximum)');
          } else {
            showToast('Invalid room state. Please try another room.');
          }
        }
      } catch (error) {
        console.error('Error joining room:', error);
        showToast('Failed to join room. Please try again.');
      }
    }

    // Auto-format room ID input to numbers only
    document.getElementById('roomIdInput').addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/[^0-9]/g, '');
    });
  </script>
</body>
</html>